<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุญุณุงุจู </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
<h2>ุญุณุงุจู</h2>

<label>ุฑูู ุงููุงุชู</label>
<input id="phone" disabled>

<label>ุงุณู ุงููุณุชุฎุฏู</label>
<input id="name">

<button onclick="saveName()">๐พ ุญูุธ</button>
<button class="home-btn" onclick="goHome()">๐ ุงูุฑุฆูุณูุฉ</button>
<hr>

<h3>ุญุฌูุฒุงุชู ุงูุณุงุจูุฉ</h3>
<ul id="bookings"></ul>

 </div> 
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzkCyA7V3fcAZqT87mVLeGqFe5mi3XjQIMwIr3jA5OC0fhdsAlCvZZ-wiAFlg653v8/exec";
const API = SCRIPT_URL;
const phone = localStorage.getItem("phone");

if (!phone) location.href="auth.html";

// ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    action:"get_user",
    phone:phone
  })
})
.then(r=>r.json())
.then(d=>{
  document.getElementById("phone").value = d.phone;
  document.getElementById("name").value = d.name;
});

// ุญูุธ ุงูุงุณู
function saveName(){
  fetch(API,{
    method:"POST",
    body:new URLSearchParams({
      action:"update_user",
      phone:phone,
      name:document.getElementById("name").value
    })
  }).then(()=>alert("ุชู ุงูุญูุธ"));
}

// ุฌูุจ ุงูุญุฌูุฒุงุช
fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    action:"get_my_bookings",
    phone:phone
  })
})
.then(r=>r.json())
.then(d=>{
  const ul = document.getElementById("bookings");
  d.bookings.forEach(b=>{
    ul.innerHTML += `<li>${b.date} - ${b.doctor} (${b.city})</li>`;
  });
});
</script>

<!-- ุฑุจุท ููู ุงูุญูุงูุฉ -->
<script src="auth-guard.js"></script>
</body>
</html>  
