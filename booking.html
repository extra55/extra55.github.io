<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div class="container">
<h2>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠ</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
<select id="city" onchange="updateDoctors()">
<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© --</option>
<option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
<option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø±</option>
</select>

<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
<input type="text" id="name">

<label>Ø§Ø®ØªØ± Ø§Ù„Ø§Ø®ØªØµØ§Øµ</label>
<select id="specialty" onchange="filterDoctors()">
<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø§Ø®ØªØµØ§Øµ --</option>
</select>

<label>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
<select id="doctor" onchange="showAddress()">
<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ --</option>
</select>

<div id="addressBox" class="address-box" style="display:none;"></div>

<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</label>
<input type="date" id="date">

<button onclick="book()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
<button class="home-btn" onclick="goHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<p id="msg"></p>
</div>
  <style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f9;
  margin: 0;
}
.container {
  max-width: 400px;
  margin: 80px auto;
  background: white;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,.1);
}
h2 { text-align: center; color: #0d6efd; }
label { display: block; margin-top: 10px; font-weight: bold; }
input, select {
  width: 100%;
  padding: 12px;
  margin-top: 5px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  background: #0d6efd;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}
button:hover { background: #084298; }
.home-btn {
  background: #6c757d;
}
.home-btn:hover {
  background: #5a6268;
}
.msg { text-align: center; margin-top: 10px; }

.address-box {
  margin-top: 8px;
  padding: 10px;
  background: #f1f3f5;
  border-radius: 6px;
  font-size: 14px;
  color: #333;
}
</style>

<script>
const API = "Ø¶Ø¹_Ø±Ø§Ø¨Ø·_Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª_Ù‡Ù†Ø§";
let allDoctors = [];

// ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
const savedCity = localStorage.getItem("city");
if (savedCity) {
  city.value = savedCity;
  updateDoctors();
}

function updateDoctors() {
  const cityVal = city.value;
  localStorage.setItem("city", cityVal);

  specialty.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø§Ø®ØªØµØ§Øµ --</option>';
  doctor.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ --</option>';
  addressBox.style.display = "none";

  if (!cityVal) return;

  const fd = new FormData();
  fd.append("action","get_doctors");
  fd.append("city",cityVal);

  fetch(API,{method:"POST",body:fd})
  .then(r=>r.json())
  .then(d=>{
    allDoctors = d.doctors;
    [...new Set(allDoctors.map(x=>x.specialty))].forEach(s=>{
      specialty.innerHTML += `<option>${s}</option>`;
    });
  });
}

function filterDoctors(){
  doctor.innerHTML='<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ --</option>';
  allDoctors.filter(d=>d.specialty===specialty.value)
  .forEach(d=>{
    const o=document.createElement("option");
    o.value=d.name;
    o.textContent=d.name;
    o.dataset.address=d.address;
    doctor.appendChild(o);
  });
}

function showAddress(){
  const o=doctor.options[doctor.selectedIndex];
  if(o?.dataset.address){
    addressBox.innerText="ğŸ“ "+o.dataset.address;
    addressBox.style.display="block";
  } else addressBox.style.display="none";
}

function book(){
  if(!city.value||!doctor.value||!name.value||!date.value){
    msg.innerText="ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";return;
  }

  const fd=new FormData();
  fd.append("action","booking");
  fd.append("city",city.value);
  fd.append("doctor_id",doctor.value);
  fd.append("patient_name",name.value);
  fd.append("phone",localStorage.getItem("phone"));
  fd.append("date",date.value);

  fetch(API,{method:"POST",body:fd})
  .then(r=>r.json())
  .then(d=>msg.innerText=d.message);
}

function goHome(){location.href="index.html";}
</script>

</body>
</html>
