<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>حجز موعد</title>
  <link rel="stylesheet" href="style.css">

  <script>
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "auth.html";
    }
  </script>
</head>
<body>

<div class="container">
  <h2>حجز موعد طبي</h2>

  <select id="doctor">
    <option value="">اختر الطبيب</option>
    <option value="د. أحمد – باطنية">د. أحمد – باطنية</option>
    <option value="د. علي – أسنان">د. علي – أسنان</option>
    <option value="د. سارة – نسائية">د. سارة – نسائية</option>
  </select>

  <input type="text" id="name" placeholder="اسم المريض">
  <input type="date" id="date">

  <button onclick="book()">تأكيد الحجز</button>
  <button onclick="logout()" style="margin-top:10px;background:#6c757d;">تسجيل خروج</button>

  <p class="msg" id="msg"></p>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzArIwABi-DoEVypA9qp6N9YSdlWCb_RQZ0Usv9zpvm_SPPlgmyIg8ssoKoK9PN3WNF/exec";
const phone = localStorage.getItem("phone");

const dateInput = document.getElementById("date");
dateInput.min = new Date().toISOString().split("T")[0];

function book() {
  const doctor = document.getElementById("doctor").value;
  const name = document.getElementById("name").value.trim();
  const date = dateInput.value;
  const msg = document.getElementById("msg");

  if (!doctor || !name || !date) {
    msg.innerText = "❌ يرجى ملء جميع الحقول";
    return;
  }

  const data = new URLSearchParams();
  data.append("action", "booking");
  data.append("doctor", doctor);
  data.append("patient_name", name);
  data.append("phone", phone);
  data.append("date", date);

  fetch(API, {
    method: "POST",
    body: data
  })
  .then(r => r.text())
  .then(res => {
    const [status, message] = res.split("|");
    msg.innerText = message;

    if (status === "success") {
      document.getElementById("doctor").value = "";
      document.getElementById("name").value = "";
      dateInput.value = "";
    }
  })
  .catch(() => {
    msg.innerText = "فشل الاتصال بالسيرفر";
  });
}

function logout() {
  localStorage.clear();
  window.location.href = "auth.html";
}
</script>

</body>
</html>
