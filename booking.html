<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>حجز موعد</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h2>حجز موعد طبي</h2>
  <label>اسم المريض</label>
  <input type="text" id="name" placeholder="اكتب اسمك الكامل">

  <label>اختر الطبيب</label>
  <select id="doctor">
    <option value="">-- اختر الطبيب --</option>
    <option value="د. أحمد – باطنية">د. أحمد – باطنية</option>
    <option value="د. علي – أسنان">د. علي – أسنان</option>
    <option value="د. سارة – نسائية">د. سارة – نسائية</option>
  </select>

  <label>تاريخ / موعد الحجز</label>
  <input type="date" id="date">

  <button onclick="book()">تأكيد الحجز</button>
  <button class="logout-btn" onclick="confirmLogout()">تسجيل الخروج</button>

  <p class="msg" id="msg"></p>
</div>
<style>
.logout-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 6px;
  cursor: pointer;
  float: left;
  margin-bottom: 10px;
}

.logout-btn:hover {
  background: #bb2d3b;
}
</style>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f9;
  margin: 0;
}

.container {
  max-width: 400px;
  margin: 80px auto;
  background: white;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,.1);
}

h2 {
  text-align: center;
  color: #0d6efd;
}

label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 12px;
  margin-top: 5px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  background: #0d6efd;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background: #084298;
}

.msg {
  text-align: center;
  margin-top: 10px;
}
</style>
<script>
if (!localStorage.getItem("loggedIn")) {
  window.location.replace("auth.html");
}

  
// منع الرجوع للصفحة بعد تسجيل الخروج
window.addEventListener("pageshow", function () {
  if (!localStorage.getItem("loggedIn")) {
    window.location.replace("auth.html");
  }
});

  
function confirmLogout() {
  const ok = confirm("هل أنت متأكد من تسجيل الخروج؟");

  if (ok) {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("phone");
    window.location.href = "index.html";
  }
}

  
const API = "https://script.google.com/macros/s/AKfycbwYjso7-Oi0xdhPPE0dJvLfeAme4wpyfqg27VfCecrJ6hXpCYW7Qbn0KLo0Y3I8r36l/exec";
const phone = localStorage.getItem("phone");

// حماية الصفحة
if (!localStorage.getItem("loggedIn")) {
  alert("يجب تسجيل الدخول أولاً");
  window.location.href = "auth.html";
}

// منع اختيار تاريخ قديم
const today = new Date().toISOString().split("T")[0];
document.getElementById("date").setAttribute("min", today);

function book() {
  const doctor = document.getElementById("doctor").value;
  const name   = document.getElementById("name").value;
  const date   = document.getElementById("date").value;
  const msg    = document.getElementById("msg");

  msg.innerText = "";

  if (!doctor || !name || !date) {
    msg.innerText = "يرجى ملء جميع الحقول";
    return;
  }

  const formData = new FormData();
  formData.append("action", "booking");
  formData.append("doctor_id", doctor); // الآن اسم الطبيب
  formData.append("patient_name", name);
  formData.append("phone", phone);
  formData.append("date", date);

  fetch(API, {
    method: "POST",
    body: formData
  })
  .then(r => r.text())
  .then(t => {
    console.log("RAW:", t);
    const data = JSON.parse(t);

    msg.innerText = data.message;

    if (data.status === "success") {
      // مسح الحقول بعد النجاح
      document.getElementById("doctor").value = "";
      document.getElementById("name").value = "";
      document.getElementById("date").value = "";
    }
  })
  .catch(() => {
    msg.innerText = "فشل الاتصال بالسيرفر";
  });
}
</script>

</body>
</html>
