<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>حجز موعد</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <button class="logout-btn" onclick="confirmLogout()">تسجيل الخروج</button>

  <h2>حجز موعد طبي</h2>

  <label>اسم المريض</label>
  <input type="text" id="name" placeholder="اكتب اسمك الكامل">

  <label>اختر الطبيب</label>
  <select id="doctor">
    <option value="">-- اختر الطبيب --</option>
    <option value="د. أحمد – باطنية">د. أحمد – باطنية</option>
    <option value="د. علي – أسنان">د. علي – أسنان</option>
    <option value="د. سارة – نسائية">د. سارة – نسائية</option>
  </select>

  <label>تاريخ / موعد الحجز</label>
  <input type="date" id="date">

  <button onclick="book()">تأكيد الحجز</button>

  <p class="msg" id="msg"></p>
</div>

<style>
.logout-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 6px;
  cursor: pointer;
  float: left;
  margin-bottom: 10px;
}

.logout-btn:hover {
  background: #bb2d3b;
}
</style>

<script>
function confirmLogout() {
  const ok = confirm("هل أنت متأكد من تسجيل الخروج؟");

  if (ok) {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("phone");
    window.location.href = "index.html";
  }
}

  
const API = "https://script.google.com/macros/s/AKfycbxL6b69WRgSaxmB1AmyDzHNNVz4DtjyOkVQJSsC3YZMGZiAkBFgR49gEyuRMFpA5b3X/exec";
const phone = localStorage.getItem("phone");

// حماية الصفحة
if (!localStorage.getItem("loggedIn")) {
  alert("يجب تسجيل الدخول أولاً");
  window.location.href = "auth.html";
}

// منع اختيار تاريخ قديم
const today = new Date().toISOString().split("T")[0];
document.getElementById("date").setAttribute("min", today);

function book() {
  const doctor = document.getElementById("doctor").value;
  const name   = document.getElementById("name").value;
  const date   = document.getElementById("date").value;
  const msg    = document.getElementById("msg");

  msg.innerText = "";

  if (!doctor || !name || !date) {
    msg.innerText = "يرجى ملء جميع الحقول";
    return;
  }

  const formData = new FormData();
  formData.append("action", "booking");
  formData.append("doctor_id", doctor); // الآن اسم الطبيب
  formData.append("patient_name", name);
  formData.append("phone", phone);
  formData.append("date", date);

  fetch(API, {
    method: "POST",
    body: formData
  })
  .then(r => r.text())
  .then(t => {
    console.log("RAW:", t);
    const data = JSON.parse(t);

    msg.innerText = data.message;

    if (data.status === "success") {
      // مسح الحقول بعد النجاح
      document.getElementById("doctor").value = "";
      document.getElementById("name").value = "";
      document.getElementById("date").value = "";
    }
  })
  .catch(() => {
    msg.innerText = "فشل الاتصال بالسيرفر";
  });
}
</script>

</body>
</html>
